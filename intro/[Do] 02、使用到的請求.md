<div align="center">

# 2ï¸âƒ£ ä½¿ç”¨åˆ°çš„è«‹æ±‚

</div>

## ğŸ”‘ **å¾ F12 å–å¾—è³‡æ–™çš„è©³ç´°æ­¥é©Ÿ**

```
1. F12 â†’ Network æ¨™ç±¤
2. ç™¼é€ä¸€æ¢è¨Šæ¯ï¼ˆåˆ†åˆ¥æœ‰å¾ç©ºç™½å‡ºå»ã€å¾å·²ç¶“å‚³éè¨Šæ¯çš„å‡ºå»ï¼‰
3. æ‰¾åˆ° POST è«‹æ±‚ï¼ˆnew æˆ– responsesï¼‰
```

<img src="/image/image02.png" width="100%">

### **å–å¾— API URLï¼š**

> åˆ†åˆ¥å–å¾—é–‹å•Ÿæ–°å°è©±ï¼ˆnewï¼‰ã€å»¶çºŒå°è©±ï¼ˆresponsesï¼‰çš„ URL

```
4. é»æ“Š â†’ Headers æ¨™ç±¤ï¼Œæœƒçœ‹åˆ°ä¸‹é¢çš„ POST å…§å®¹ï¼š

POST
scheme:https
host:grok.ylsagi.com
filename:/rest/app-chat/conversations/new

é€£çµå°±æ˜¯ --> https://grok.ylsagi.com/rest/app-chat/conversations/new
```

### **å–å¾— Cookieï¼š**
```
4. é»æ“Š â†’ Cookie æ¨™ç±¤
5. æ‰¾åˆ° Cookie: é‚£ä¸€è¡Œ
6. è¤‡è£½æ•´è¡Œå…§å®¹ï¼ˆå¾ˆé•·ï¼‰
7. è²¼åˆ°ç¨‹å¼ç¢¼çš„ HEADERS["Cookie"]
```

### **å–å¾— Request Payloadï¼š**
```
4. é»æ“Š â†’ Payload æ¨™ç±¤ï¼ˆæˆ– Requestï¼‰
5. æœƒçœ‹åˆ° JSON æ ¼å¼çš„è³‡æ–™
6. è¤‡è£½æ•´å€‹çµæ§‹
7. å°ç…§åˆ° build_payload() å‡½å¼ä¸­
8. å°‡å‹•æ…‹çš„éƒ¨åˆ†ï¼ˆå¦‚ messageï¼‰æ”¹æˆè®Šæ•¸
```

### **å–å¾— Response æ ¼å¼ï¼š**
```
4. é»æ“Š â†’ Response æ¨™ç±¤
5. æœƒçœ‹åˆ°å¾ˆå¤šè¡Œ JSON
6. è§€å¯Ÿçµæ§‹ï¼Œæ‰¾å‡º token åœ¨å“ªè£¡
7. å¯«å‡ºå°æ‡‰çš„è§£æé‚è¼¯
```

---

## ğŸŸ¢ ç¸½çµï¼šF12 çš„æˆæœ

ä½ åœ¨é€™ä»½ç¨‹å¼ç¢¼ä¸­ï¼Œä¸»è¦é‹ç”¨äº† F12 åµæ¸¬åˆ°çš„ **4** é¡æ ¸å¿ƒæƒ…å ±ï¼š

1.  **URL (API ç«¯é») --> çŸ¥é“è¦å‘¼å«å“ªå€‹ç¶²å€:**
    *   ä½ ç™¼ç¾äº†**å‰µå»ºæ–°å°è©±**çš„ç«¯é»æ˜¯ `.../conversations/new`ã€‚
    *   ï¼ˆé›–ç„¶åœ¨é€™å€‹ç‰ˆæœ¬æ²’ç”¨åˆ°ï¼Œä½†ä½ ä¹ŸçŸ¥é“**ç¹¼çºŒå°è©±**çš„ç«¯é»æ˜¯ `.../conversations/{id}/responses`ï¼‰ã€‚
    *   **å°æ‡‰ç¨‹å¼ç¢¼ï¼š** `url = f"{GROK_BASE_URL}/rest/app-chat/conversations/new"`

2. **Cookie (èªè­‰è³‡è¨Š) --> æœ€é‡è¦:**
    *   ä½ è¤‡è£½äº†å®Œæ•´çš„ `Cookie` ç”¨æ–¼èº«ä»½é©—è­‰ã€‚

2.  **RequestÂ Headers (è«‹æ±‚æ¨™é ­) --> å½è£è³‡è¨Š:**
    *   ä½ è¤‡è£½äº† `User-Agent`, `Origin`, `Referer` ç­‰ç”¨ä¾†å½è£æˆçœŸå¯¦ç€è¦½å™¨ã€‚
    *   ä½ ç™¼ç¾äº† `x-xai-request-id` å’Œ `x-statsig-id` é€™äº›ç‰¹æ®Šçš„è‡ªè¨‚æ¨™é ­ã€‚
    *   **å°æ‡‰ç¨‹å¼ç¢¼ï¼š** æ•´å€‹ `HEADERS` å­—å…¸ã€‚

3.  **RequestÂ Payload (è«‹æ±‚é«”) --> è«‹æ±‚æœ¬é«”çµæ§‹:**
    *   ä½ æ•ç²äº†ç™¼é€ç¬¬ä¸€æ¢æ¶ˆæ¯æ™‚ï¼Œç€è¦½å™¨å¯¦éš›æäº¤çš„ JSON æ•¸æ“šçµæ§‹ï¼ŒåŒ…å«äº† `message`, `modelName`, `modelMode` ç­‰å¹¾åå€‹åƒæ•¸ã€‚
    *   **å°æ‡‰ç¨‹å¼ç¢¼ï¼š** `build_payload` å‡½æ•¸çš„è¿”å›å€¼ã€‚

4.  **Response (ä¼ºæœå™¨éŸ¿æ‡‰) --> å›æ‡‰è³‡æ–™çµæ§‹:**
    *   é€šéè§€å¯Ÿæ—¥èªŒä¸­ä¼ºæœå™¨è¿”å›çš„æµå¼æ•¸æ“šï¼Œä½ ç™¼ç¾äº† `token`ã€`conversationId`ã€`responseId` é€™äº›é—œéµè³‡è¨Šéƒ½è—åœ¨ä¸€å€‹åµŒå¥—çš„ `response` ç‰©ä»¶è£¡ã€‚
    *   **å°æ‡‰ç¨‹å¼ç¢¼ï¼š** `parse_streaming_response` å‡½æ•¸ä¸­çš„è§£æé‚è¼¯ã€‚
  
## ğŸŸ¢ æå–ä»¥ä¸‹è³‡æ–™ï¼š

| è³‡æ–™é …ç›® | F12 ä¸­çš„ä½ç½® | ç¨‹å¼ç¢¼ä¸­çš„ä½ç½® | èªªæ˜ |
|---------|-------------|---------------|------|
| **API URL** | Request URL | `url = f"{GROK_BASE_URL}/rest/app-chat/conversations/new"` | API çš„å®Œæ•´ç¶²å€ |
| **Cookie** | Headers â†’ Cookie | `HEADERS["Cookie"]` | èº«åˆ†é©—è­‰è³‡è¨Šï¼ŒæœƒéæœŸ |
| **User-Agent** | Headers â†’ User-Agent | `HEADERS["User-Agent"]` | ç€è¦½å™¨è­˜åˆ¥è³‡è¨Š |
| **Origin** | Headers â†’ Origin | `HEADERS["Origin"]` | è«‹æ±‚ä¾†æºç¶²åŸŸ |
| **Referer** | Headers â†’ Referer | `HEADERS["Referer"]` | åƒç…§é é¢ |
| **x-xai-request-id** | Headers â†’ x-xai-request-id | `headers["x-xai-request-id"]` | è«‹æ±‚å”¯ä¸€è­˜åˆ¥ç¢¼ |
| **x-statsig-id** | Headers â†’ x-statsig-id | `headers["x-statsig-id"]` | çµ±è¨ˆè¿½è¹¤ ID |
| **Request Payload** | Payload æˆ– Request æ¨™ç±¤ | `build_payload()` å‡½å¼ | è«‹æ±‚æœ¬é«”çš„å®Œæ•´çµæ§‹ |
| **Response æ ¼å¼** | Response æ¨™ç±¤ | `parse_streaming_response()` å‡½å¼ | å›æ‡‰è³‡æ–™çš„çµæ§‹ |

